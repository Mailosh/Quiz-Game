import React, { useState } from 'react';
import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';

const Quiz = () => {
  const [teamNames, setTeamNames] = useState(['', '', '']);
  const [gameStarted, setGameStarted] = useState(false);
  const [currentQuestion, setCurrentQuestion] = useState(0);
  const [scores, setScores] = useState({ team1: 0, team2: 0, team3: 0 });
  const [teamAnswers, setTeamAnswers] = useState({
    team1: null,
    team2: null,
    team3: null
  });
  const [gameFinished, setGameFinished] = useState(false);
  const [showCorrectAnswer, setShowCorrectAnswer] = useState(false);

  const questions = [ /* ...your questions here... */ ];

  const handleTeamNameChange = (index, value) => {
    const newTeamNames = [...teamNames];
    newTeamNames[index] = value;
    setTeamNames(newTeamNames);
  };

  const startGame = () => {
    if (teamNames.every(name => name.trim() !== '')) {
      setGameStarted(true);
    } else {
      alert('Prosím, zadajte názvy všetkých tímov');
    }
  };

  const handleTeamAnswer = (team, answer) => {
    setTeamAnswers(prev => ({
      ...prev,
      [team]: answer
    }));
  };

  const checkAnswersAndProceed = () => {
    if (Object.values(teamAnswers).every(answer => answer !== null)) {
      const newScores = { ...scores };
      Object.entries(teamAnswers).forEach(([team, answer]) => {
        if (answer === questions[currentQuestion].correct) {
          newScores[team] += 1;
        }
      });
      setScores(newScores);
      setTeamAnswers({ team1: null, team2: null, team3: null });

      if (currentQuestion === questions.length - 1) {
        setGameFinished(true);
      } else {
        setCurrentQuestion(prev => prev + 1);
      }
    }
  };

  const evaluateAnswers = () => {
    setShowCorrectAnswer(true);
  };

  const getWinner = () => {
    const maxScore = Math.max(scores.team1, scores.team2, scores.team3);
    const winners = [];
    if (scores.team1 === maxScore) winners.push(teamNames[0]);
    if (scores.team2 === maxScore) winners.push(teamNames[1]);
    if (scores.team3 === maxScore) winners.push(teamNames[2]);
    return winners.length > 1 ? "Remíza medzi: " + winners.join(", ") : "Víťazom je: " + winners[0];
  };

  if (!gameStarted) {
    return (
      <div className="font-['Roboto',sans-serif] bg-gray-50 min-h-screen p-4">
        <Card className="w-full max-w-4xl mx-auto shadow-lg">
          <CardHeader>
            <CardTitle className="text-2xl text-center">Zadajte názvy tímov</CardTitle>
          </CardHeader>
          <CardContent className="space-y-4">
            {teamNames.map((name, index) => (
              <div key={index} className="flex items-center space-x-2">
                <span className="w-20">Tím {index + 1}:</span>
                <Input
                  value={name}
                  onChange={(e) => handleTeamNameChange(index, e.target.value)}
                  placeholder={`Názov tímu ${index + 1}`}
                />
              </div>
            ))}
            <Button onClick={startGame} className="w-full mt-4">
              Začať hru
            </Button>
          </CardContent>
        </Card>
      </div>
    );
  }

  if (gameFinished) {
    return (
      <div className="font-['Roboto',sans-serif] bg-gray-50 min-h-screen p-4">
        <Card className="w-full max-w-4xl mx-auto shadow-lg">
          <CardHeader className="bg-gradient-to-r from-pink-50 to-purple-50">
            <CardTitle className="text-2xl text-center text-gray-700">
              Koniec hry!
            </CardTitle>
          </CardHeader>
          <CardContent className="p-6">
            <div className="text-center space-y-4">
              <h2 className="text-3xl font-bold text-gray-800">{getWinner()}</h2>
              <div className="space-y-2">
                <p className="text-xl">{teamNames[0]}: {scores.team1} bodov</p>
                <p className="text-xl">{teamNames[1]}: {scores.team2} bodov</p>
                <p className="text-xl">{teamNames[2]}: {scores.team3} bodov</p>
              </div>
              <div className="mt-8 bg-black rounded-lg p-4">
                <div className="text-white text-xl mb-2">
                  NEMÁM PROBLÉM S ALKOHOLOM.
                </div>
                <div className="text-white text-xl mb-4">
                  IBA BEZ NEHO
                </div>
                <div className="text-white text-lg italic">
                  - PETER STAŠÁK, OBJAVITEĽ
                </div>
              </div>
            </div>
          </CardContent>
        </Card>
      </div>
    );
  }

  return (
    <div className="font-['Roboto',sans-serif] bg-gray-50 min-h-screen p-4">
      <Card className="w-full max-w-4xl mx-auto shadow-lg">
        <CardHeader className="bg-gradient-to-r from-pink-50 to-purple-50">
          <CardTitle className="flex justify-between items-center text-2xl">
            <span className="text-gray-700">Otázka {currentQuestion + 1}/10</span>
          </CardTitle>
        </CardHeader>
        <CardContent className="p-6">
          <div className="space-y-6">
            <div className="text-xl font-medium text-gray-800">
              {questions[currentQuestion].question}
            </div>
            <div className="overflow-x-auto">
              <table className="w-full border-collapse">
                <thead>
                  <tr>
                    <th className="border p-2">Možnosti</th>
                    {teamNames.map((name, index) => (
                      <th key={index} className="border p-2 text-center">
                        {name}
                      </th>
                    ))}
                  </tr>
                </thead>
                <tbody>
                  {questions[currentQuestion].options.map((option, optionIndex) => (
                    <tr key={optionIndex}>
                      <td className="border p-2">{option}</td>
                      {['team1', 'team2', 'team3'].map((team, teamIndex) => (
                        <td key={`${team}-${optionIndex}`} className="border p-2 text-center">
                          <Button
                            onClick={() => handleTeamAnswer(team, optionIndex)}
                            variant={teamAnswers[team] === optionIndex ? "default" : "outline"}
                            className={`w-full ${showCorrectAnswer && optionIndex === questions[currentQuestion].correct ? 'bg-green-500' : ''}`}
                          >
                            {String.fromCharCode(65 + optionIndex)}
                          </Button>
                        </td>
                      ))}
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
            <div className="flex justify-between">
              <div className="space-y-2">
                {teamNames.map((name, index) => (
                  <p key={index} className="font-medium">
                    {name}: {scores[`team${index + 1}`]} bodov
                  </p>
                ))}
              </div>
              <Button 
                onClick={evaluateAnswers}
                className="self-end"
              >
                Vyhodnotenie
              </Button>
            </div>
            <Button 
              onClick={checkAnswersAndProceed}
              disabled={!Object.values(teamAnswers).every(answer => answer !== null)}
              className="self-end mt-4"
            >
              Ďalšia otázka
            </Button>
          </div>
        </CardContent>
      </Card>
    </div>
  );
};

export default Quiz;